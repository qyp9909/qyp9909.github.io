<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>搜广推笔记 指标 | Kyoku's Blog</title><meta name="author" content="Yuanpeng QU"><meta name="copyright" content="Yuanpeng QU"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="搜广推[指标]Created by: Yuanpeng QUCreated time: 2025年8月11日 16:14 一、 开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？整个对话的起点，就是那个在工业界极其经典的问题：为什么我离线辛辛苦苦优化的模型，AUC涨了好几个点，但一上线，核心业务指标（如CTR、收入）就是不涨，甚至还会下跌？ 这个问题之所以重要，是因为它点明了一个残酷的">
<meta property="og:type" content="article">
<meta property="og:title" content="搜广推笔记 指标">
<meta property="og:url" content="https://qyp9909.github.io/2025/08/11/Rec_AD_Metrics/index.html">
<meta property="og:site_name" content="Kyoku&#39;s Blog">
<meta property="og:description" content="搜广推[指标]Created by: Yuanpeng QUCreated time: 2025年8月11日 16:14 一、 开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？整个对话的起点，就是那个在工业界极其经典的问题：为什么我离线辛辛苦苦优化的模型，AUC涨了好几个点，但一上线，核心业务指标（如CTR、收入）就是不涨，甚至还会下跌？ 这个问题之所以重要，是因为它点明了一个残酷的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://qyp9909.github.io/images/cover/Rec_AD_Cover.png">
<meta property="article:published_time" content="2025-08-11T06:00:00.000Z">
<meta property="article:modified_time" content="2025-08-11T08:18:18.894Z">
<meta property="article:author" content="Yuanpeng QU">
<meta property="article:tag" content="Study">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qyp9909.github.io/images/cover/Rec_AD_Cover.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "搜广推笔记 指标",
  "url": "https://qyp9909.github.io/2025/08/11/Rec_AD_Metrics/",
  "image": "https://qyp9909.github.io/images/cover/Rec_AD_Cover.png",
  "datePublished": "2025-08-11T06:00:00.000Z",
  "dateModified": "2025-08-11T08:18:18.894Z",
  "author": [
    {
      "@type": "Person",
      "name": "Yuanpeng QU",
      "url": "https://qyp9909.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://qyp9909.github.io/2025/08/11/Rec_AD_Metrics/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '搜广推笔记 指标',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="defer" onload="this.media='all'"><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><link rel="preload" as="image" href="/img/1.jpg"><link rel="preload" href="/fonts/circle400w.ttf" as="font" type="font/ttf" crossorigin="anonymous"><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/img/1.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/LOGO.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-vihara"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Articles</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-mug-hot"></i><span> Life</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> Gallery</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fab fa-itunes-note"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fab fa-youtube"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-torii-gate"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-star-of-david"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Kyoku's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">搜广推笔记 指标</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-vihara"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-newspaper"></i><span> Articles</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-mug-hot"></i><span> Life</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> Gallery</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fab fa-itunes-note"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fab fa-youtube"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-torii-gate"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-star-of-david"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">搜广推笔记 指标</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-08-11T06:00:00.000Z" title="Created 2025-08-11 15:00:00">2025-08-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-11T08:18:18.894Z" title="Updated 2025-08-11 17:18:18">2025-08-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Recsys/">Recsys</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="搜广推-指标"><a href="#搜广推-指标" class="headerlink" title="搜广推[指标]"></a>搜广推[指标]</h3><p>Created by: Yuanpeng QU<br>Created time: 2025年8月11日 16:14</p>
<h3 id="一、-开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？"><a href="#一、-开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？" class="headerlink" title="一、 开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？"></a><strong>一、 开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？</strong></h3><p>整个对话的起点，就是那个在工业界极其经典的问题：<strong>为什么我离线辛辛苦苦优化的模型，AUC涨了好几个点，但一上线，核心业务指标（如CTR、收入）就是不涨，甚至还会下跌？</strong></p>
<p>这个问题之所以重要，是因为它点明了一个残酷的现实：<strong>离线评估环境只是真实线上环境的一个不完美的“模拟器”</strong>。如果我们不理解这个模拟器（离线评估）的局限性，就会被虚高的指标迷惑，做出错误的判断。造成这种“线上线下不一致”的原因主要有三点：</p>
<ol>
<li><strong>特征不一致</strong>：由于数据处理延迟，线上实时服务用的特征可能是几个小时前的旧特征，而离线训练时却用了最新的特征。模型在线下学会了依赖“新特征”，但在线上根本用不上，效果自然会差。</li>
<li><strong>数据分布不一致</strong>：线上的数据是动态变化的，比如一个新上线的推荐模型，它遇到的用户和物品分布，和它在“旧模型”产生的数据集上训练时遇到的分布是完全不同的。</li>
<li><strong>评估目标不一致</strong>：这是最核心的一点。比如，我们离线用AUC来评估一个排序模型，但历史数据本身就带有<strong>位置偏见</strong>（排在前面的物品更容易被点击）。离线AUC高，可能只是因为模型学会了这种偏见，而不是真正学会了判断物品的质量。</li>
</ol>
<p><strong>这引出了我们为什么需要深入理解评估指标的根本原因：</strong></p>
<p>因为一个单一、粗糙的离线指标（比如不加思考就使用的AUC）是<strong>不足以</strong>反映模型在线上真实价值的。我们需要一整套<strong>正确且全面</strong>的评估指标体系，来从不同维度审视我们的模型，确保离线评估的结果能最大程度上**“预测”**线上的表现。</p>
<p>比如，为了解决“位置偏见”问题，我们需要引入对位置更敏感的<strong>NDCG</strong>；为了评估个性化推荐的效果，我们需要用<strong>GAUC</strong>来代替AUC；为了判断模型预测的pCTR分数是否可以直接用于广告竞价，我们还需要引入<strong>校准度</strong>指标。</p>
<p>因此，对评估指标的深入理解，是我们连接“模型技术”和“业务价值”的唯一桥梁。</p>
<h3 id="二、-核心分野：理解评估指标的两大家族——分类指标-vs-排序指标"><a href="#二、-核心分野：理解评估指标的两大家族——分类指标-vs-排序指标" class="headerlink" title="二、 核心分野：理解评估指标的两大家族——分类指标 vs. 排序指标"></a><strong>二、 核心分野：理解评估指标的两大家族——分类指标 vs. 排序指标</strong></h3><p>在我们讨论的所有指标中，它们基本可以被归入两个大的家族，理解这个区别是后续一切讨论的基础。</p>
<p><strong>1. 分类指标 (Classification Metrics)</strong></p>
<ul>
<li><strong>回答的问题是</strong>：“这个样本属于A类还是B类？” 它是一个“<strong>是非题</strong>”。</li>
<li><strong>核心目标</strong>：判断模型做出的<strong>单个预测的准确性</strong>。</li>
<li><strong>典型场景</strong>：<ul>
<li>判断一封邮件是否是“垃圾邮件”。</li>
<li>判断一个用户是否会“点击”某个广告。</li>
<li>判断一张图片里的是“猫”还是“狗”。</li>
</ul>
</li>
<li><strong>代表指标</strong>：<strong>准确率(Accuracy)、精确率(Precision)、召回率(Recall)、F1分数</strong>。这些指标都围绕着一个<strong>固定的分类阈值</strong>（比如，预测概率 &gt; 0.5 就判为正类）下的混淆矩阵（TP, FP, TN, FN）来计算。</li>
</ul>
<p><strong>2. 排序指标 (Ranking Metrics)</strong></p>
<ul>
<li><strong>回答的问题是</strong>：“给定一批物品，应该按什么顺序呈现给用户才是最好的？” 它是一个“<strong>排序题</strong>”。</li>
<li><strong>核心目标</strong>：判断模型给出的一个<strong>有序列表的整体质量</strong>。</li>
<li><strong>典型场景</strong>：<ul>
<li>搜索引擎返回的结果列表。</li>
<li>信息流推荐的内容顺序。</li>
<li>电商网站的商品推荐列表。</li>
</ul>
</li>
<li><strong>代表指标</strong>：<strong>AUC、GAUC、NDCG、MRR、Hit Rate</strong>。这些指标通常不关心单一物品的预测分数究竟是多少，而更关心<strong>不同物品之间的相对顺序</strong>是否正确，尤其是列表头部的顺序。</li>
</ul>
<p><strong>两者的联系与区别</strong></p>
<p>在“搜广推”中，这两个家族紧密相连。我们通常会先训练一个<strong>分类模型</strong>（如CTR预估模型）来为每一个候选物品打一个分数（如pCTR），然后再利用这些分数来进行<strong>排序</strong>。</p>
<p>这就引出了像<strong>AUC</strong>这样处于“十字路口”的特殊指标：</p>
<ul>
<li>我们用它来评估一个<strong>分类模型</strong>。</li>
<li>但它的内在含义（一个正样本排在负样本前面的概率）却是在衡量这个模型分数所隐含的<strong>排序能力</strong>。</li>
</ul>
<p>理解了这个核心分野，我们就能明白为什么不能用“准确率”去评估一个推荐列表的好坏，也更能理解为什么AUC会在排序任务中扮演如此重要的角色。这是我们选择正确评估工具的第一步。</p>
<h3 id="三、-分类任务评估：走出“准确率陷阱”，拥抱P-R权衡（精确率、召回率、F1分数）"><a href="#三、-分类任务评估：走出“准确率陷阱”，拥抱P-R权衡（精确率、召回率、F1分数）" class="headerlink" title="三、 分类任务评估：走出“准确率陷阱”，拥抱P-R权衡（精确率、召回率、F1分数）"></a><strong>三、 分类任务评估：走出“准确率陷阱”，拥抱P-R权衡（精确率、召回率、F1分数）</strong></h3><p>在评估一个分类模型时，最朴素的想法就是：“模型预测对了多少？”。这引出了最直观的指标——准确率（Accuracy）。然而，在“搜广推”这种样本极不均衡的场景下，准确率是一个充满欺骗性的“陷阱”。为了做出正确的评估，我们必须理解并使用一套更严谨的指标：精确率（Precision）、召回率（Recall）以及它们的平衡 F1分数（F1-Score）。</p>
<h3 id="1-万物的基础：混淆矩阵-Confusion-Matrix"><a href="#1-万物的基础：混淆矩阵-Confusion-Matrix" class="headerlink" title="1. 万物的基础：混淆矩阵 (Confusion Matrix)"></a>1. 万物的基础：混淆矩阵 (Confusion Matrix)</h3><p>在介绍所有指标前，我们必须先理解一个工具——<strong>混淆矩阵</strong>。它是一个表格，用来总结我们的模型预测结果与真实情况之间的关系。</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>真实为正 (Actual Positive)</strong></th>
<th><strong>真实为负 (Actual Negative)</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>预测为正 (Predicted Positive)</strong></td>
<td><strong>TP (True Positive)</strong> <br> 真正例</td>
<td><strong>FP (False Positive)</strong> <br> 假正例</td>
</tr>
<tr>
<td><strong>预测为负 (Predicted Negative)</strong></td>
<td><strong>FN (False Negative)</strong> <br> 假负例</td>
<td><strong>TN (True Negative)</strong> <br> 真负例</td>
</tr>
</tbody></table>
<p>导出到 Google 表格</p>
<ul>
<li><strong>TP (真正例)</strong>：模型预测为正，实际也为正。（预测会点击，用户真的点了）</li>
<li><strong>FP (假正例)</strong>：模型预测为正，实际却为负。（预测会点击，用户没点）—— <strong>Type I Error，误报</strong></li>
<li><strong>FN (假负例)</strong>：模型预测为负，实际却为正。（预测不点击，用户结果点了）—— <strong>Type II Error，漏报</strong></li>
<li><strong>TN (真负例)</strong>：模型预测为负，实际也为负。（预测不点击，用户真的没点）</li>
</ul>
<h3 id="2-“准确率陷阱”：为什么99-的准确率可能毫无价值？"><a href="#2-“准确率陷阱”：为什么99-的准确率可能毫无价值？" class="headerlink" title="2. “准确率陷阱”：为什么99%的准确率可能毫无价值？"></a>2. “准确率陷阱”：为什么99%的准确率可能毫无价值？</h3><ul>
<li><p><strong>如何计算</strong>：</p>
<p>  $$<br>  Accuracy &#x3D; \frac{TP + TN}{TP + TN + FP + FN} &#x3D; \frac{所有预测正确的}{总样本数}<br>  $$</p>
</li>
<li><p><strong>意义</strong>：衡量模型在所有样本上（无论正负）预测正确的比例。</p>
</li>
<li><p><strong>陷阱举例（CTR预估）</strong>：<br>假设我们有1000个广告曝光样本，其中只有1个被用户点击（1个正样本），剩下999个都未被点击（999个负样本）。<br>现在有一个“懒惰”的模型，它不对任何数据进行学习，只是无脑地预测所有曝光都<strong>不会被点击</strong>。<br>我们用混淆矩阵来看它的表现：</p>
<ul>
<li>TP &#x3D; 0 (没有预测任何点击)</li>
<li>FP &#x3D; 0 (没有把“未点击”误报为“点击”)</li>
<li>FN &#x3D; 1 (漏掉了那个唯一的真实点击)</li>
<li>TN &#x3D; 999 (正确预测了所有未点击的样本)</li>
</ul>
<p>  它的准确率是：<code>(0 + 999) / (0 + 0 + 1 + 999) = 999 / 1000 = 99.9%</code>。<br>  这个模型有着近乎完美的准确率，但它对我们的业务（找到会点击的用户）<strong>没有任何帮助</strong>，因为它一个正样本都找不到。这就是“准确率陷阱”。</p>
</li>
</ul>
<h3 id="3-精确率-Precision-vs-召回率-Recall-：一枚硬币的两面"><a href="#3-精确率-Precision-vs-召回率-Recall-：一枚硬币的两面" class="headerlink" title="3. 精确率 (Precision) vs. 召回率 (Recall)：一枚硬币的两面"></a>3. 精确率 (Precision) vs. 召回率 (Recall)：一枚硬币的两面</h3><p>为了走出陷阱，我们需要把目光聚焦于我们真正关心的“正样本”上。精确率和召回率就是从两个不同的角度来衡量模型“寻找正样本”的能力。</p>
<h3 id="精确率-Precision-查准率"><a href="#精确率-Precision-查准率" class="headerlink" title="精确率 (Precision) &#x2F; 查准率"></a><strong>精确率 (Precision) &#x2F; 查准率</strong></h3><ul>
<li><p><strong>如何计算</strong>：</p>
<p>  $$<br>  Precision &#x3D; \frac{TP}{TP+FP} &#x3D; \frac{真正是正例}{所有被你预测为正例的}<br>  $$</p>
</li>
<li><p><strong>意义</strong>：衡量的是**“你预测出来的结果有多准”**。在你所有认为是“正”的预测中，有多少是真的。</p>
</li>
<li><p><strong>业务场景举例</strong>：</p>
<ul>
<li><strong>发优惠券</strong>：你希望推送的优惠券，用户领了之后真的会去用。如果推了很多别人不用的（FP高），不仅浪费了营销预算，还会骚扰用户。此时，你需要高精确率。</li>
<li><strong>高风险股票推荐</strong>：你推荐给用户的“会上涨”的股票，最好真的能涨。推荐错了（FP高），用户会亏钱。此时，你需要高精确率。</li>
</ul>
</li>
<li><p><strong>一句话理解</strong>：<strong>宁缺毋滥</strong>。我推荐的一定要好，哪怕因此少推荐了一些。</p>
</li>
</ul>
<h3 id="召回率-Recall-查全率"><a href="#召回率-Recall-查全率" class="headerlink" title="召回率 (Recall) &#x2F; 查全率"></a><strong>召回率 (Recall) &#x2F; 查全率</strong></h3><ul>
<li><p><strong>如何计算</strong>：</p>
<p>  $$<br>  Recall &#x3D; \frac{TP}{TP + FN} &#x3D; \frac{被你找出的正例}{所有真实存在的正例}<br>  $$</p>
</li>
<li><p><strong>意义</strong>：衡量的是**“<code>所有该找出来的，你找到了多少</code>”**。<strong>在所有真实为“正”的样本中，你成功识别出了多少</strong>。</p>
</li>
<li><p><strong>业务场景举例</strong>：</p>
<ul>
<li><strong>诊断癌症</strong>：在所有真正的癌症患者中（FN的代价是生命），我们希望尽可能多地把他们都找出来，哪怕因此误诊了一些健康的人（FP高），让他们再去做一次检查。此时，你需要高召回率。</li>
<li><strong>推荐系统召回层</strong>：在海量的物品库中，我们希望把用户<strong>所有可能</strong>感兴趣的物品都找出来，送到排序模型那里去。漏掉一个（FN高），就永远失去了一次推荐这个物品的机会。此时，你需要高召回率。</li>
</ul>
</li>
<li><p><strong>一句话理解</strong>：<strong>宁可错杀，不可放过</strong>。我可能推荐了一些不那么好的，但一定要把所有好的都包含进来。</p>
</li>
</ul>
<h3 id="4-F1分数：在“准”与“全”之间寻求平衡"><a href="#4-F1分数：在“准”与“全”之间寻求平衡" class="headerlink" title="4. F1分数：在“准”与“全”之间寻求平衡"></a>4. F1分数：在“准”与“全”之间寻求平衡</h3><p>我们发现，精确率和召回率往往是相互制约的。要提高召回率，就要放宽标准，这样精确率就可能下降；反之亦然。为了综合评价一个模型，我们需要一个能平衡这两者的指标——F1分数。</p>
<ul>
<li><p><strong>如何计算</strong>：</p>
<p>  $$<br>  F1 &#x3D; 2 \times \frac{Precision \times Recall}{Precision + Recall}<br>  $$</p>
</li>
<li><p><strong>意义</strong>：F1分数是精确率和召回率的<strong>调和平均值</strong>。</p>
</li>
<li><p><strong>为什么用调和平均？</strong> 调和平均值的一个重要特性是，它会更偏向于两个数中较小的那个。如果Precision或Recall中有一个值极低，F1分数就会被严重拉低。这强迫我们必须让两个指标都达到一个较高的水平，从而实现真正的“平衡”。</p>
</li>
</ul>
<p><strong>总结</strong>：在分类任务中，我们不能仅仅满足于高“准确率”。必须深入到混淆矩阵，结合业务目标，去分析模型的<strong>精确率</strong>和<strong>召回率</strong>，并在两者之间做出最合适的权衡，而<strong>F1分数</strong>为我们提供了一个量化这种权衡的有效工具。如果用算数平均简单计算则会在极端的情况下出问题，比如100个真实病人和9900个健康人都被诊断患病。</p>
<h3 id="四、-排序质量评估（上）：全局排序的王者——AUC的深刻内涵与个性化升级（GAUC）"><a href="#四、-排序质量评估（上）：全局排序的王者——AUC的深刻内涵与个性化升级（GAUC）" class="headerlink" title="四、 排序质量评估（上）：全局排序的王者——AUC的深刻内涵与个性化升级（GAUC）"></a><strong>四、 排序质量评估（上）：全局排序的王者——AUC的深刻内涵与个性化升级（GAUC）</strong></h3><p>在排序任务中，我们需要的不仅仅是一个能判断“是与非”的分类器，更需要一个能排出“好与坏”顺序的裁判。AUC及其升级版GAUC，就是这个裁判手中的黄金标准。</p>
<h3 id="一-全局排序的王者-——-AUC-Area-Under-the-Curve"><a href="#一-全局排序的王者-——-AUC-Area-Under-the-Curve" class="headerlink" title="(一) 全局排序的王者 —— AUC (Area Under the Curve)"></a>(一) 全局排序的王者 —— AUC (Area Under the Curve)</h3><p>AUC的全称是“ROC曲线下的面积”，但这个几何名称远不如它的概率意义来得深刻和实用。</p>
<p><strong>1. AUC的双重定义</strong></p>
<ul>
<li><strong>几何意义（它是什么样）</strong>：AUC是<strong>ROC曲线</strong>下方的面积。ROC曲线的横轴是<strong>假阳率(FPR)</strong>，纵轴是<strong>真阳率(TPR)</strong>，它描绘了模型在所有分类阈值下，TPR随FPR变化的轨迹。AUC的值在0.5到1之间，一个随机猜测的模型AUC为0.5，一个完美的模型AUC为1。</li>
<li><strong>概率意义（它代表什么）</strong>：这是理解AUC的精髓。<strong>AUC代表了“随机抽取一个正样本和一个负样本，你的模型将该正样本的预测分数排在负样本之上的概率有多大”</strong>。这个定义将一个看似复杂的指标，转化为了一个极其直观的“排序正确率”的概念。</li>
</ul>
<p><strong>2. 为什么说AUC是“王者”？—— 它的三大优势</strong></p>
<ol>
<li><strong>不依赖阈值 (Threshold-Independent)</strong>：无论是精确率、召回率还是F1分数，它们的计算都依赖于一个固定的分类阈值（比如<code>pCTR &gt; 0.5</code>）。而阈值的选择本身就是一个难题。AUC则评估了模型在<strong>所有可能阈值下</strong>的综合排序能力，衡量的是模型排序性能的“内功”，更具全局性和稳定性。</li>
<li><strong>对样本不均衡不敏感 (Insensitive to Class Imbalance)</strong>：这在“搜广推”场景下是压倒性的优势。我们之前已经看到，准确率在CTR预估这种正负样本比例1:1000的场景下会完全失效。而AUC因为其基于“样本对”的排序概率定义，其计算结果与正负样本的比例无关，能够非常稳定、客观地反映模型在倾斜数据上的表现。</li>
<li><strong>物理意义明确 (Intuitive Meaning)</strong>：“衡量模型将正样本排在负样本前面的概率”，这个解释非常直观，便于算法工程师之间以及与业务方进行沟通。</li>
</ol>
<p><strong>3. AUC如何计算？—— 排序与计数的艺术</strong></p>
<p>虽然可以通过绘制ROC曲线然后计算面积，但在实践中，我们更多地使用它等价的概率定义来计算，效率更高。</p>
<p>$$<br>AUC &#x3D; \frac{\text{正样本预测概率 &gt; 负样本预测概率的次数} + 0.5 \times \text{正负样本预测概率相等的次数}}{m \times n}<br>$$</p>
<p><strong>举例说明：</strong><br>假设有2个正样本(P1, P2)和2个负样本(N1, N2)，模型打分如下：</p>
<ul>
<li>P1: 0.8</li>
<li>P2: 0.6</li>
<li>N1: 0.7</li>
<li>N2: 0.3</li>
</ul>
<p>总共有 <code>2 * 2 = 4</code> 个正负样本对：</p>
<ol>
<li>(P1, N1): score(0.8) &gt; score(0.7) -&gt; <strong>排序正确</strong></li>
<li>(P1, N2): score(0.8) &gt; score(0.3) -&gt; <strong>排序正确</strong></li>
<li>(P2, N1): score(0.6) &lt; score(0.7) -&gt; <strong>排序错误</strong></li>
<li>(P2, N2): score(0.6) &gt; score(0.3) -&gt; <strong>排序正确</strong></li>
</ol>
<p>在4个样本对中，有3个排序正确。因此，AUC &#x3D; 3 &#x2F; 4 &#x3D; <strong>0.75</strong>。</p>
<h3 id="二-个性化升级-——-GAUC-Grouped-AUC"><a href="#二-个性化升级-——-GAUC-Grouped-AUC" class="headerlink" title="(二) 个性化升级 —— GAUC (Grouped AUC)"></a>(二) 个性化升级 —— GAUC (Grouped AUC)</h3><p>AUC虽然强大，但它有一个致命的缺陷：它衡量的是<strong>全局</strong>的排序能力。</p>
<p><strong>1. AUC的困境：张三的苹果和李四的橘子</strong></p>
<p>在推荐系统中，我们关心的是<strong>为每个用户提供个性化的、精准的排序</strong>。<br>假设一个场景：</p>
<ul>
<li>小明喜欢低分段的物品，模型给他推荐的物品分数都在0.1-0.2之间，且排序完美（<strong>小明的AUC&#x3D;1.0</strong>）。</li>
<li>小红喜欢高分段的物品，模型给她推荐的物品分数都在0.8-0.9之间，且排序也完美（<strong>小红的AUC&#x3D;1.0</strong>）。</li>
</ul>
<p>如果用普通的AUC计算，它会把小明喜欢的物品（比如0.15分）和小红不喜欢的物品（比如0.85分）进行比较，得出“排序错误”的结论，从而拉低整体AUC。但这种跨用户的比较是<strong>毫无意义</strong>的，我们并不关心模型是否把小明喜欢的物品排在小红不喜欢物品的前面。</p>
<p><strong>2. GAUC的解决方案：“先分组，再计算，后加权平均”</strong></p>
<p>GAUC完美地解决了这个问题。它的计算方法如下：</p>
<ol>
<li><strong>分组 (Group)</strong>：将所有样本按照“组”进行划分，在推荐场景下，这个“组”通常就是**<code>user_id</code>*。</li>
<li><strong>计算 (Calculate)</strong>：在<strong>每一个组（用户）内部</strong>，独立计算该用户的AUC。这样就避免了跨用户的比较。</li>
<li><strong>加权平均 (Weighted Average)</strong>：将所有用户的AUC值，按照一定的权重进行加权平均，得到最终的GAUC。最常用的权重是<strong>用户的曝光量（Impression）</strong>，即该用户在测试集中有多少样本。</li>
</ol>
<p><strong>GAUC公式:</strong></p>
<p>$$<br>GAUC &#x3D; \frac{\sum_{i&#x3D;1}^{N} AUC_i \times w_i}{\sum_{i&#x3D;1}^{N} w_i}<br>$$</p>
<p>其中, <code>N</code>是总用户数, <code>AUC_i</code>是第i个用户的AUC, <code>w_i</code>是第i个用户的权重（如曝光量）。</p>
<p><strong>结论：</strong> GAUC通过强制在用户内部进行评估，真正衡量了模型的<strong>个性化排序能力</strong>，是目前业界评估个性化推荐模型时，离线最重要的核心指标，没有之一。</p>
<h3 id="五、-排序质量评估（下）：面向用户的Top-K列表评估（NDCG、Recall-k、Hit-Rate）"><a href="#五、-排序质量评估（下）：面向用户的Top-K列表评估（NDCG、Recall-k、Hit-Rate）" class="headerlink" title="五、 排序质量评估（下）：面向用户的Top-K列表评估（NDCG、Recall@k、Hit Rate）"></a><strong>五、 排序质量评估（下）：面向用户的Top-K列表评估（NDCG、Recall@k、Hit Rate）</strong></h3><h3 id="1-命中率-Hit-Rate-k-——-“我的推荐有用吗？”"><a href="#1-命中率-Hit-Rate-k-——-“我的推荐有用吗？”" class="headerlink" title="1. 命中率 (Hit Rate @k) —— “我的推荐有用吗？”"></a>1. 命中率 (Hit Rate @k) —— “我的推荐有用吗？”</h3><p>这是最简单、最直观的Top-K指标。</p>
<ul>
<li><p><strong>核心思想</strong>：它只回答一个“是”或“否”的问题：“在给用户推荐的K个物品中，是否<strong>至少有1个</strong>是他真正喜欢的？”</p>
</li>
<li><p><strong>如何计算</strong>：</p>
<p>  $$<br>  HitRate@k &#x3D; \frac{至少命中1个推荐的用户数}{总用户数}<br>  $$</p>
</li>
<li><p><strong>举例说明</strong>：<br>假设我们为3位用户都推荐了Top-5的商品 (<code>k=5</code>)。</p>
<ul>
<li><strong>小明</strong>：推荐了<code>[A, B, C, D, E]</code>，他实际购买了<code>[B, F]</code>。–&gt; 因为推荐的B被购买了，所以对小明算一次<strong>命中(Hit)</strong>。</li>
<li><strong>小红</strong>：推荐了<code>[G, H, I, J, K]</code>，她实际购买了<code>[L]</code>。–&gt; 因为推荐的商品她都没买，所以算一次<strong>未命中(Miss)</strong>。</li>
<li><strong>小李</strong>：推荐了<code>[M, N, O, P, Q]</code>，他实际购买了<code>[P, R, S]</code>。–&gt; 因为推荐的P被购买了，所以也算一次<strong>命中(Hit)</strong>。</li>
</ul>
<p>  最终，<code>Hit Rate@5 = 2 / 3 ≈ 66.7%</code>。
  </p>
</li>
<li><p><strong>评价</strong>：</p>
<ul>
<li><strong>优点</strong>：非常容易理解和计算，便于向业务方沟通，能快速了解推荐的有效覆盖率。</li>
<li><strong>缺点</strong>：<strong>极其粗糙</strong>。它不关心命中了几个，也不关心命中的物品排在第几位。在上面的例子中，小明和小李都被算作一次“命中”，但我们无法区分是命中1个好，还是命中多个好，也无法区分是排在第1位命中好，还是第5位命中好。</li>
</ul>
</li>
</ul>
<h3 id="2-召回率-Recall-k-——-“用户喜欢的，我找回了多少？”"><a href="#2-召回率-Recall-k-——-“用户喜欢的，我找回了多少？”" class="headerlink" title="2. 召回率 (Recall @k) —— “用户喜欢的，我找回了多少？”"></a>2. 召回率 (Recall @k) —— “用户喜欢的，我找回了多少？”</h3><p>这个指标比命中率更进了一步，它开始关心“命中数量”的比例。</p>
<ul>
<li><p><strong>核心思想</strong>：对于一个用户，在他所有真正喜欢的物品中，我们推荐的Top-K列表成功“覆盖”了多大的比例？</p>
</li>
<li><p><strong>如何计算</strong>：</p>
<p>  $$<br>  Recall@k(单用户) &#x3D; \frac{TopK推荐中命中用户喜好的物品数量}{该用户所有喜好的物品总数}<br>  $$</p>
<p>  最终的指标是所有用户的<code>Recall@k</code>的平均值，即 <strong>Mean Recall@k</strong>。</p>
</li>
<li><p><strong>举例说明</strong>（沿用上面的例子）：</p>
<ul>
<li><strong>小明</strong>：推荐命中1个(<code>B</code>)，但他总共喜欢2个(<code>B, F</code>)。<code>Recall@5 = 1 / 2 = 0.5</code>。</li>
<li><strong>小红</strong>：推荐命中0个，她总共喜欢1个(<code>L</code>)。<code>Recall@5 = 0 / 1 = 0.0</code>。</li>
<li><strong>小李</strong>：推荐命中1个(<code>P</code>)，他总共喜欢3个(<code>P, R, S</code>)。<code>Recall@5 = 1 / 3 ≈ 0.33</code>。</li>
</ul>
<p>  最终，<code>Mean Recall@5 = (0.5 + 0.0 + 0.33) / 3 ≈ 0.277</code>。
  </p>
</li>
<li><p><strong>评价</strong>：</p>
<ul>
<li><strong>优点</strong>：相比Hit Rate，它考虑了命中数量的比例，更能反映推荐的“查全”能力。</li>
<li><strong>缺点</strong>：它依然<strong>不关心位置</strong>。排在第1位命中和排在第k位命中，对它的贡献是完全一样的。</li>
</ul>
</li>
</ul>
<h3 id="3-NDCG-k-归一化折损累计增益-——-“排得好不好？”"><a href="#3-NDCG-k-归一化折损累计增益-——-“排得好不好？”" class="headerlink" title="3. NDCG @k (归一化折损累计增益) —— “排得好不好？”"></a>3. NDCG @k (归一化折损累计增益) —— “排得好不好？”</h3><p>这是Top-K评估指标中的“王者”，因为它最全面，既考虑了命中的数量，也考虑了命中的位置，甚至能考虑命中的“程度”。</p>
<ul>
<li><p><strong>核心思想</strong>：</p>
<ol>
<li><strong>相关性（Gain）</strong>：越相关的物品，得分越高。</li>
<li><strong>位置折损（Discounted）</strong>：排在越前面的物品，其价值越高；排在越后面，其价值就要打折扣。</li>
<li><strong>归一化（Normalized）</strong>：让不同用户之间的得分可以公平比较。</li>
</ol>
</li>
<li><p><strong>如何计算</strong>（我们在上一个问题中详细演算过，这里回顾其精髓）：</p>
<ol>
<li><strong>计算DCG</strong>：对推荐列表中的每个物品，根据其<strong>真实相关性<code>rel_i</code>和位置<code>i</code></strong>，计算一个带折扣的得分<code>rel_i / log₂(i+1)</code>，然后全部加起来。</li>
<li><strong>计算IDCG</strong>：计算理论上<strong>最完美的推荐列表</strong>能拿到的DCG分数。</li>
<li><strong>计算NDCG</strong>：<code>NDCG@k=DCG@k / IDCG@k</code></li>
</ol>
</li>
<li><p><strong>举例说明</strong>：</p>
<ul>
<li><strong>场景A</strong>：Top-5推荐列表在第1位命中了用户最喜欢的物品（相关性&#x3D;3分）。</li>
<li><strong>场景B</strong>：Top-5推荐列表在第5位命中了同一个物品（相关性&#x3D;3分）。</li>
</ul>
<p>  对于场景A，它的DCG贡献是<code>3 / log₂(1+1) = 3.0</code>。<br>  对于场景B，它的DCG贡献是<code>3 / log₂(5+1) ≈ 1.16</code>。<br>  显而易见，NDCG严厉地惩罚了场景B这种把好东西排在后面的行为。</p>
<p>  一个例子：推荐系统经过计算，给小红的推荐列表（前5名）是这样的：</p>
<p>  第1步：计算模型的DCG: 我们来为系统推荐的列表计算<code>DCG@5</code>：</p>
<table>
<thead>
<tr>
<th>位置 (i)</th>
<th>推荐电影</th>
<th>真实喜好度 (rel_i)</th>
<th>折扣 <code>log₂(i+1)</code></th>
<th>折扣后增益 <code>rel_i / log₂(i+1)</code></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>《电影B》</td>
<td>2</td>
<td><code>log₂(1+1) = 1</code></td>
<td>2 &#x2F; 1 &#x3D; 2.0</td>
</tr>
<tr>
<td>2</td>
<td>《电影A》</td>
<td>3</td>
<td><code>log₂(2+1) ≈ 1.585</code></td>
<td>3 &#x2F; 1.585 ≈ 1.893</td>
</tr>
<tr>
<td>3</td>
<td>《电影E》</td>
<td>1</td>
<td><code>log₂(3+1) = 2</code></td>
<td>1 &#x2F; 2 &#x3D; 0.5</td>
</tr>
<tr>
<td>4</td>
<td>《电影C》</td>
<td>3</td>
<td><code>log₂(4+1) ≈ 2.322</code></td>
<td>3 &#x2F; 2.322 ≈ 1.292</td>
</tr>
<tr>
<td>5</td>
<td>《电影D》</td>
<td>0</td>
<td><code>log₂(5+1) ≈ 2.585</code></td>
<td>0 &#x2F; 2.585 &#x3D; 0.0</td>
</tr>
</tbody></table>
<p>  <strong>DCG@5</strong> &#x3D; 2.0 + 1.893 + 0.5 + 1.292 + 0.0 &#x3D; <strong>5.685</strong></p>
<p>  第2步：计算理想的IDCG (Ideal DCG)</p>
<p>  IDCG代表的是<strong>理论上最完美的推荐列表</strong>能拿到的DCG分数。完美的列表，就是把所有电影按照真实喜好度从高到低排序。我们用同样的方法计算这个“完美列表”的<code>IDCG@5</code>：</p>
<table>
<thead>
<tr>
<th>位置 (i)</th>
<th>完美推荐</th>
<th>真实喜好度 (rel_i)</th>
<th>折扣 <code>log₂(i+1)</code></th>
<th>折扣后增益 <code>rel_i / log₂(i+1)</code></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>《电影A》</td>
<td>3</td>
<td><code>log₂(1+1) = 1</code></td>
<td>3 &#x2F; 1 &#x3D; 3.0</td>
</tr>
<tr>
<td>2</td>
<td>《电影C》</td>
<td>3</td>
<td><code>log₂(2+1) ≈ 1.585</code></td>
<td>3 &#x2F; 1.585 ≈ 1.893</td>
</tr>
<tr>
<td>3</td>
<td>《电影B》</td>
<td>2</td>
<td><code>log₂(3+1) = 2</code></td>
<td>2 &#x2F; 2 &#x3D; 1.0</td>
</tr>
<tr>
<td>4</td>
<td>《电影E》</td>
<td>1</td>
<td><code>log₂(4+1) ≈ 2.322</code></td>
<td>1 &#x2F; 2.322 ≈ 0.431</td>
</tr>
<tr>
<td>5</td>
<td>《电影D》</td>
<td>0</td>
<td><code>log₂(5+1) ≈ 2.585</code></td>
<td>0 &#x2F; 2.585 &#x3D; 0.0</td>
</tr>
</tbody></table>
<p>  <strong>IDCG@5</strong> &#x3D; 3.0 + 1.893 + 1.0 + 0.431 + 0.0 &#x3D; <strong>6.324</strong></p>
<p>  第3步：计算最终的NDCG (Normalized DCG)</p>
<p>  <strong>NDCG@5</strong> &#x3D; 5.685 &#x2F; 6.324 ≈ <strong>0.899</strong>
  </p>
</li>
<li><p><strong>评价</strong>：</p>
<ul>
<li><strong>优点</strong>：<strong>最全面、最科学</strong>的Top-K排序评估指标。它对位置敏感，且能处理多级的相关性（比如：购买 &gt; 点击 &gt; 曝光），非常适合评估搜索和推荐这种对排序极其敏感的系统。</li>
<li><strong>缺点</strong>：计算相对复杂，且需要定义一个明确的相关性等级。</li>
</ul>
</li>
</ul>
<p><strong>总结</strong></p>
<p>这三个指标形成了一个评估的“进阶三部曲”：</p>
<ul>
<li><strong>Hit Rate</strong>：最基础，看“有没有”。</li>
<li><strong>Recall@k</strong>：进一步，看“有多少”。</li>
<li><strong>NDCG@k</strong>：最全面，看“有多少”并且“排得好不好”。</li>
</ul>
<h3 id="六、-进阶辨析：如何在ROC-AUC与PR曲线-F1分数之间做出正确选择？"><a href="#六、-进阶辨析：如何在ROC-AUC与PR曲线-F1分数之间做出正确选择？" class="headerlink" title="六、 进阶辨析：如何在ROC&#x2F;AUC与PR曲线&#x2F;F1分数之间做出正确选择？"></a><strong>六、 进阶辨析：如何在ROC&#x2F;AUC与PR曲线&#x2F;F1分数之间做出正确选择？</strong></h3><p>在机器学习的工具箱里，并没有一个“万能”的评估指标。选择使用AUC还是F1（以及它们各自的曲线），不是一个“谁更高级”的问题，而是一个“谁更合适”的问题。这个选择主要取决于两个核心维度：<strong>1. 你的数据集样本是否均衡？</strong> <strong>2. 你的业务目标和最终应用场景是什么？</strong></p>
<h3 id="辨析一：样本不均衡问题-——-ROC曲线-vs-PR曲线"><a href="#辨析一：样本不均衡问题-——-ROC曲线-vs-PR曲线" class="headerlink" title="辨析一：样本不均衡问题 —— ROC曲线 vs. PR曲线"></a>辨析一：样本不均衡问题 —— ROC曲线 vs. PR曲线</h3><p>这是区分使用这两条曲线最关键的第一个考量点。</p>
<ul>
<li><strong>当你的数据集相对均衡时：ROC曲线&#x2F;AUC是稳定且优秀的选择。</strong><ul>
<li>在这种情况下，假阳率（FPR）能够真实地反映模型将负样本错判为正样本的比例，ROC曲线能清晰地展示出模型在“找到多少真病人(TPR)”和“误诊多少健康人(FPR)”之间的权衡，AUC给出的也是一个非常稳定可靠的综合评分。</li>
</ul>
</li>
<li><strong>当你的数据集高度不均衡时：PR曲线是更佳的诊断工具。</strong><ul>
<li>我们之前已经详细分析过，在正负样本比例悬殊（如1:1000）的情况下，ROC曲线会因为其横轴FPR对大量的真负例(TN)不敏感，而显得**“过于乐观”**，无法有效暴露模型的问题。</li>
<li>PR曲线的两个坐标轴（Precision和Recall）都聚焦于正样本的表现，对假正例(FP)的变化极为敏感。它能更“诚实”、更“严苛”地反映出模型在“大海捞针”式的任务中，其性能到底好不好。</li>
</ul>
</li>
</ul>
<p><strong>决策依据</strong>：拿到一个分类问题，你首先要问自己：“我的数据是否存在严重的类别不平衡？” 如果答案是肯定的，那么在你的评估报告中，<strong>PR曲线和它下方的面积（AUPRC）必须占有一席之地</strong>，因为它能告诉你ROC曲线可能隐藏起来的真相。</p>
<h3 id="辨析二：业务目标与应用-——-AUC-vs-F1分数"><a href="#辨析二：业务目标与应用-——-AUC-vs-F1分数" class="headerlink" title="辨析二：业务目标与应用 —— AUC vs. F1分数"></a>辨析二：业务目标与应用 —— AUC vs. F1分数</h3><p>这是第二个考量点，它关注的是“模型评估服务于什么目的”。</p>
<ul>
<li><strong>当你的目标是评估模型的“整体排序能力”或“内在潜力”时：选择AUC。</strong><ul>
<li>如果你想在离线阶段比较两个不同算法或特征工程的优劣，而<strong>不关心最终线上使用的具体阈值</strong>，AUC是最好的选择。</li>
<li>AUC衡量的是模型“是骡子是马”的根本能力，即它区分好坏样本的排序内功有多深厚。在CTR预估这类典型的排序任务中，AUC是核心的离线评估指标，因为它直接反映了模型为后续排序提供的分数质量。</li>
</ul>
</li>
<li><strong>当你的目标是评估模型在“某个固定决策点”上的表现时：选择F1分数。</strong><ul>
<li>如果你的模型最终上线后，需要根据一个<strong>固定的、明确的阈值</strong>来做出“是”或“否”的判断，那么F1分数是更具指导意义的指标。</li>
<li>F1分数直接告诉你，在这个阈值下，模型在“查准”和“查全”这两个具体任务上的平衡做得怎么样。</li>
<li><strong>典型例子</strong>：<ul>
<li><strong>垃圾邮件过滤</strong>：系统必须做出一个最终决定：这封邮件是“垃圾邮件”（放入垃圾箱）还是“正常邮件”（放入收件箱）。我们需要在某个阈值下评估这个决定的质量，此时F1分数（或者直接看P和R）更有意义。</li>
<li><strong>欺诈检测</strong>：风控系统需要决定是否“拦截”一笔交易。这个“拦截”与否的决定，就是在某个阈值下做出的，其产生的业务成本（错误拦截FP vs. 漏掉欺诈FN）非常直观，适合用F1分数来度量。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="总结与决策流程"><a href="#总结与决策流程" class="headerlink" title="总结与决策流程"></a>总结与决策流程</h3><p>我们可以将选择过程总结为一个简单的决策流程：</p>
<ol>
<li><strong>第一问：我的数据是否严重不平衡？</strong><ul>
<li><strong>是</strong> -&gt; 必须重点关注 <strong>PR曲线</strong>，用它来诊断模型在少数类上的真实表现。</li>
<li><strong>否</strong> -&gt; <strong>ROC曲线&#x2F;AUC</strong> 是一个非常可靠的起点。</li>
</ul>
</li>
<li><strong>第二问：我的业务最终是需要一个排序列表，还是一个确定的分类决策？</strong><ul>
<li><strong>需要排序列表</strong>（如推荐、搜索） -&gt; <strong>AUC&#x2F;GAUC</strong> 是核心离线指标，因为它衡量排序质量。</li>
<li><strong>需要确定决策</strong>（如是否拦截交易） -&gt; <strong>F1分数&#x2F;精确率&#x2F;召回率</strong> 是核心离线指标，因为它衡量在特定决策点上的性能。</li>
</ul>
</li>
</ol>
<p>在成熟的工业实践中，我们从不会只看一个指标。一个优秀的算法工程师会给出一份全面的评估报告：“我们的新模型，在GAUC上提升了2个百分点，证明其个性化排序的整体能力更强。同时，从PR曲线上看，它在高召回率区间的精确率有明显改善，这意味着我们能在覆盖更多用户兴趣的同时保证更高的准确性。在最终部署的阈值下，F1分数也提升了3%，这将直接转化为线上业务的收益。”</p>
<h3 id="七、-终极话题：当模型“说谎”时——超越排序，评估预测的“可信度”（校准度与LogLoss）"><a href="#七、-终极话题：当模型“说谎”时——超越排序，评估预测的“可信度”（校准度与LogLoss）" class="headerlink" title="七、 终极话题：当模型“说谎”时——超越排序，评估预测的“可信度”（校准度与LogLoss）"></a><strong>七、 终极话题：当模型“说谎”时——超越排序，评估预测的“可信度”（校准度与LogLoss）</strong></h3><p><strong>模型的“谎言”是什么？</strong><br>就是它预测出的概率分数，与其代表的真实世界中的概率不符。我们之前讨论过，AUC无法区分模型预测的0.95和0.81，只要它们都排在0.8前面即可。但0.95和0.81这两个分数本身，可能都是“谎言”。</p>
<p>一个模型可能对某个广告预测的pCTR是0.8（即80%），这是一个极高的分数，能让它在排序中胜出。但实际上，类似得到0.8分的所有广告，它们真实的平均点击率可能只有10%。这就意味着，模型虽然排对了序，但它对自己预测的“自信程度”撒了谎，它严重地**过分自信（Over-confident）**了。</p>
<p>评估和修正这种“谎言”的能力，就是**校准度（Calibration）**分析。</p>
<p><strong>1. 为什么我们需要“可信的”预测分数？</strong></p>
<p>在很多场景下，我们需要的不仅仅是一个相对的排序，更是那个<strong>绝对的、可信的概率值</strong>，因为它直接指导着真金白银的决策。</p>
<ul>
<li><strong>场景一：计算广告中的智能出价 (oCPC&#x2F;oCPM)</strong><br>这是最经典的场景。广告平台需要预估一个广告的点击率<code>pCTR</code>，然后乘以广告主的出价<code>bid</code>，得到<code>eCPM (expected Cost Per Mille)</code>，并以此来进行排序和竞价。<ul>
<li>如果你的模型<strong>高估</strong>了pCTR（比如预测8%，实际只有4%），平台就会错误地提高出价，导致广告主成本虚高，ROI下降，最终广告主可能会停止投放。</li>
<li>如果你的模型<strong>低估</strong>了pCTR，平台就会出价过低，导致广告失去曝光机会，媒体收入和广告主业务量都受损。</li>
<li>在这个场景下，一个“诚实”的pCTR值是整个商业模式的基石。</li>
</ul>
</li>
<li><strong>场景二：业务预测与规划</strong><br>一个电商平台可能会利用模型预测的转化率，来预估整个平台下一季度的总销售额。如果模型的预测普遍偏高或偏低，那么整个公司的战略规划和资源分配都会基于一个错误的数据，后果不堪设想。</li>
</ul>
<p><strong>2. 识别“谎言”的工具箱：校准度评估指标</strong></p>
<p>为了判断模型是否“诚实”，我们需要一套超越AUC的工具。</p>
<ul>
<li><strong>工具一：对数损失 (LogLoss) —— “过分自信”的惩罚者</strong><br>我们之前提到，LogLoss不仅是优秀的损失函数，也是优秀的评估指标。因为它对“过分自信的错误”惩罚极重。一个模型如果对一个负样本给出了0.99的超高分，它的LogLoss会趋近于无穷大。因此，在两个AUC相近的模型中，<strong>LogLoss更低的那个，通常校准得更好</strong>，其预测的概率值更接近真实分布。</li>
<li><strong>工具二：校准曲线 (Calibration Curve) —— 可视化的“测谎仪”</strong><br>这是一个极其直观的可视化工具。<ul>
<li><strong>做法</strong>：我们将所有预测分数分桶（如0-0.1, 0.1-0.2…），然后计算每个桶内样本的“平均预测概率”（X轴）和“真实正样本比例”（Y轴），然后将这些点连成线。</li>
<li><strong>解读</strong>：<ul>
<li><strong>诚实的模型</strong>：校准曲线会紧贴着 <code>y=x</code> 的对角线。</li>
<li><strong>过分自信的模型</strong>：曲线会在对角线下方，形成一个“U”型或“S”型。这意味着，比如当模型预测平均概率为80%时，真实概率可能只有60%。<br>  通过观察校准曲线的形状，我们可以清晰地诊断出模型是在哪些分数段“撒了谎”，以及“谎言”的模式是怎样的。</li>
</ul>
</li>
</ul>
</li>
<li><strong>工具三：期望校准误差 (ECE) —— 校准度的“量化总分”</strong><br>ECE（Expected Calibration Error）是将校准曲线的偏离程度量化成一个单一数值的指标。它计算的是每个桶的“预测概率”和“真实概率”之差的加权平均值。<strong>ECE越接近0，说明模型的校准度越好</strong>。</li>
</ul>
<p><strong>3. 如何“修正”一个说谎的模型？</strong></p>
<p>当我们发现模型的校准度很差时，除了调整模型结构和特征，还可以使用一些“事后”的校准技术，最常用的有：</p>
<ul>
<li><strong>普拉特缩放 (Platt Scaling)</strong>：用一个简单的逻辑回归模型来拟合原模型的输出。</li>
<li><strong>保序回归 (Isotonic Regression)</strong>：一种更强大的非参数方法，可以修正更复杂的校准偏差。</li>
</ul>
<p><strong>总结</strong></p>
<p>从评估排序（AUC&#x2F;NDCG）到评估校准度（LogLoss&#x2F;ECE），体现了我们对模型评估的认知深化。</p>
<ul>
<li><strong>AUC&#x2F;NDCG</strong> 保证了模型能**“做对事”**（把好的排在前面）。</li>
<li><strong>校准度</strong> 则保证了模型能**“说实话”**（预测的概率是可信的）。</li>
</ul>
<h3 id="八、-总结：从技术指标到业务价值——如何选择最合适的指标驱动增长？"><a href="#八、-总结：从技术指标到业务价值——如何选择最合适的指标驱动增长？" class="headerlink" title="八、 总结：从技术指标到业务价值——如何选择最合适的指标驱动增长？"></a><strong>八、 总结：从技术指标到业务价值——如何选择最合适的指标驱动增长？</strong></h3><p><strong>核心原则：没有“最好”的指标，只有“最合适”的指标</strong></p>
<p>这是我们所有讨论的基石。在“搜广推”的复杂世界里，试图寻找一个能包打天下的“万能指标”是徒劳的。一个指标的价值，完全取决于它能在多大程度上<strong>反映特定阶段的特定业务目标</strong>。</p>
<p>因此，选择指标的过程，本质上是一个<strong>将业务问题翻译成数学语言</strong>的过程。</p>
<p><strong>实践框架：分阶段、多维度地构建指标体系</strong></p>
<p>一个成熟的推荐或广告系统，其评估体系也应该是分阶段、多维度的，就像一个精密的仪表盘，而不是只有一个速度表。</p>
<p><strong>阶段一：召回层 (Matching&#x2F;Recall Stage)</strong></p>
<ul>
<li><strong>业务目标</strong>：“广而全”，确保不漏掉任何潜在的机会。我们需要从海量的物料库中，快速、宽泛地筛选出一个包含所有用户可能感兴趣物品的候选集。</li>
<li><strong>核心指标</strong>：<strong>Recall@k</strong> (例如 Recall@200)。我们最关心的是，在返回给排序模型的这几百个候选物料中，是否成功地覆盖了用户最终会喜欢的那些？<strong>查全率</strong>是这一阶段的生命线。</li>
</ul>
<p><strong>阶段二：排序层 (Ranking&#x2F;Scoring Stage)</strong></p>
<ul>
<li><strong>业务目标</strong>：“精而准”，对召回层给出的候选集进行精准打分，为最终的排序提供高质量的依据。这是模型算法的核心价值体现。</li>
<li><strong>核心离线指标组合</strong>：<ol>
<li><strong>GAUC (分组AUC)</strong>：<strong>绝对的核心</strong>。它衡量的是模型对每个用户的<strong>个性化排序能力</strong>。GAUC的持续提升，是模型排序“内功”增强的最直接体现。</li>
<li><strong>LogLoss &#x2F; 校准度指标 (ECE等)</strong>：当分数直接用于<strong>商业决策</strong>（如广告竞价）时，该指标与GAUC<strong>同等重要</strong>。它衡量模型预测的“可信度”，确保我们的出价和预算是基于“诚实”的概率。</li>
<li><strong>NDCG@k</strong>：可以作为辅助指标，提前观察模型在最终列表呈现上的表现，特别是对头部位置的排序能力。</li>
</ol>
</li>
</ul>
<p><strong>阶段三：最终呈现与用户体验 (Re-ranking &amp; Display)</strong></p>
<ul>
<li><strong>业务目标</strong>：确保用户最终看到的Top-K列表具有最佳的体验，不仅要精准，还要考虑多样性、新颖性等。</li>
<li><strong>核心离线指标组合</strong>：<ol>
<li><strong>NDCG@k</strong> (例如 NDCG@10)：<strong>核心中的核心</strong>。它最全面地评估了最终呈现给用户的短列表的综合质量，既考虑了物品的相关性，也考虑了位置。</li>
<li><strong>Recall@k &#x2F; Precision@k &#x2F; Hit Rate@k</strong>：作为辅助和诊断指标。Hit Rate简单直观，便于沟通；Precision@k关注推荐的准确性；Recall@k关注对用户兴趣的覆盖度。</li>
</ol>
</li>
</ul>
<p><strong>终极裁判：线上 A&#x2F;B 测试</strong></p>
<p>我们必须清醒地认识到，<strong>所有离线指标都只是线上效果的“代理指标（Proxy）”</strong>。离线指标涨得再好，也只是“模拟考”成绩优异，最终能否被采纳，必须由线上的A&#x2F;B测试这场“高考”来决定。</p>
<p>在线上A&#x2F;B测试中，我们关注的指标会更加直接和业务化：</p>
<ul>
<li><strong>短期业务指标</strong>：**CTR、CVR、GMV（成交总额）、人均停留时长、eCPM（广告千次展示收入）**等。这些指标直接关系到公司的收入和核心KPI。</li>
<li><strong>长期健康度指标</strong>：<strong>用户留存率、DAU（日活跃用户）、推荐多样性、内容消耗分布</strong>等。这些指标衡量的是我们是否以牺牲长期用户体验为代价来换取短期指标的增长。例如，一个只推荐美女图片的模型，短期CTR可能会暴涨，但长期来看会导致用户审美疲劳和流失。</li>
</ul>
<p><strong>最终结论</strong></p>
<p>从技术到价值的路径，就是建立一个<strong>从离线到线上、从单一到多维、从短期到长期</strong>的立体化评估体系。一位优秀的算法工程师，他的工作流程应该是：</p>
<ol>
<li><strong>理解业务</strong>，明确当前阶段要解决的核心问题。</li>
<li><strong>选择</strong>与之对应的、以GAUC&#x2F;NDCG等为核心的<strong>离线指标矩阵</strong>。</li>
<li>通过算法和策略的迭代，驱动<strong>离线指标</strong>的提升。</li>
<li>最终通过严谨的<strong>线上A&#x2F;B测试</strong>来验证模型是否真正带来了<strong>业务价值</strong>的增长。</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://qyp9909.github.io">Yuanpeng QU</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://qyp9909.github.io/2025/08/11/Rec_AD_Metrics/">https://qyp9909.github.io/2025/08/11/Rec_AD_Metrics/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Study/">Study</a></div><div class="post-share"><div class="social-share" data-image="/images/cover/Rec_AD_Cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/10/Rec_AD_MTL/" title="搜广推笔记 多目标排序"><img class="cover" src="/images/cover/Rec_AD_Cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">搜广推笔记 多目标排序</div></div><div class="info-2"><div class="info-item-1">搜广推[多目标排序]Created by: Yuanpeng QUCreated time: 2025年8月10日 21:12 第一部分：多目标学习的核心挑战与基础1. 动机：为何需要多目标学习？现代工业级推荐系统（如电商、短视频）的目标是综合性的，不能只关注单一指标 。例如，一个短视频推荐系统不仅要优化点击率，可能还要同时提升用户的点赞、关注、转发、评论率以及观看时长 。 如果为每个任务单独建模和优化，或者用一个简单的模型直接预测所有任务，就会遇到**“跷跷板效应” (Seesaw Phenomenon)** 。  定义：指的是当模型在优化一个目标时，会导致另一个或多个其他目标的性能下降的现象 。 举例： 任务跷跷板 (Task Seesaw)：一个模型如果过度优化点击率（CTR），可能会倾向于推荐标题党或封面吸引人的内容，但这部分内容的用户实际满意度（如观看时长、点赞率）可能很低，从而损害了长期用户体验 。 领域跷跷板 (Domain...</div></div></div></a><a class="pagination-related" href="/2025/08/12/DL_1/" title="深度学习小记"><img class="cover" src="/images/cover/Rec_AD_Cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">深度学习小记</div></div><div class="info-2"><div class="info-item-1">深度学习小记Created by: Yuanpeng QUCreated time: 2025年8月12日 17:41 I. 神经网络的核心组件与训练技巧1. 归一化层：BN 与 LN 的原理、区别与应用场景 核心目的：解决“内部协变量偏移 (Internal Covariate Shift)”问题。即在训练中，由于前层网络参数不断变化，导致后层网络接收到的数据分布一直在变，拖慢收敛速度。归一化层通过将每层网络的输入强制拉回到一个稳定的分布（如均值为0，方差为1），从而加速训练。 Batch Normalization (BN) 原理：“纵向”或“按特征”归一化。它在一个批次（mini-batch）内，对每一个特征维度计算均值和方差，并进行归一化。 关键机制：引入了两个可学习的参数 γ (缩放) 和 β (平移)，让网络可以自主决定是否以及在多大程度上恢复原始的分布，以保证模型的表达能力。 训练 vs 推理：训练时使用当前批次的统计量，同时用滑动平均记录全局统计量；推理时则使用保存下来的全局统计量，以保证输出的确定性。 应用场景：在卷积神经网络 (CNN)...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/08/08/Rec_AD_Ranking/" title="搜广推笔记 排序"><img class="cover" src="/images/cover/Rec_AD_Cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-08</div><div class="info-item-2">搜广推笔记 排序</div></div><div class="info-2"><div class="info-item-1">搜广推[排序]Created by: Yuanpeng QUCreated time: 2025年8月9日 14:29 推荐系统排序模型知识体系总结（大纲）第一章：排序模型的基础 (Foundations of Ranking Models)在深入探讨各种复杂精妙的模型之前，我们必须先理解所有排序模型所立足的共同基础。这个基础包含两个层面：一是我们如何从业务逻辑上将“排序”这个抽象任务，转化为一个可以用数学模型解决的问题；二是在这个问题的解决方案中，那个最简单、最核心的基石模型——逻辑回归（LR）——是如何工作的。 1.1...</div></div></div></a><a class="pagination-related" href="/2025/08/06/Rec_AD_Recall/" title="搜广推笔记 召回"><img class="cover" src="/images/cover/Rec_AD_Cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-06</div><div class="info-item-2">搜广推笔记 召回</div></div><div class="info-2"><div class="info-item-1">搜广推[召回]Created by: Yuanpeng QUCreated time: 2025年8月5日 22:51 一、 推荐系统总体架构 (Overall Recommendation System Architecture)1. 级联漏斗范式 (Cascading Funnel Paradigm) 现代大规模推荐系统的核心架构，普遍遵循一种级联漏斗范式 (Cascading Funnel Paradigm)。这个范式的诞生，是为了解决一个根本性的矛盾：一方面，我们的候选物品库是海量的（百万、千万甚至上亿级别）；另一方面，用户的屏幕空间是有限的，且要求响应速度极快（毫秒级）。 因此，我们不可能对所有物品都用最复杂的模型进行最精确的计算。漏斗范式通过设置多个层层递进的过滤环节，实现了从海量到少量，从粗糙到精准的逐级筛选，在计算效率和推荐效果之间取得了极致的平衡。 这个漏斗通常包含以下四个核心层级： 1. 召回层 (Recall...</div></div></div></a><a class="pagination-related" href="/2025/08/10/Rec_AD_MTL/" title="搜广推笔记 多目标排序"><img class="cover" src="/images/cover/Rec_AD_Cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-10</div><div class="info-item-2">搜广推笔记 多目标排序</div></div><div class="info-2"><div class="info-item-1">搜广推[多目标排序]Created by: Yuanpeng QUCreated time: 2025年8月10日 21:12 第一部分：多目标学习的核心挑战与基础1. 动机：为何需要多目标学习？现代工业级推荐系统（如电商、短视频）的目标是综合性的，不能只关注单一指标 。例如，一个短视频推荐系统不仅要优化点击率，可能还要同时提升用户的点赞、关注、转发、评论率以及观看时长 。 如果为每个任务单独建模和优化，或者用一个简单的模型直接预测所有任务，就会遇到**“跷跷板效应” (Seesaw Phenomenon)** 。  定义：指的是当模型在优化一个目标时，会导致另一个或多个其他目标的性能下降的现象 。 举例： 任务跷跷板 (Task Seesaw)：一个模型如果过度优化点击率（CTR），可能会倾向于推荐标题党或封面吸引人的内容，但这部分内容的用户实际满意度（如观看时长、点赞率）可能很低，从而损害了长期用户体验 。 领域跷跷板 (Domain...</div></div></div></a><a class="pagination-related" href="/2025/08/12/DL_1/" title="深度学习小记"><img class="cover" src="/images/cover/Rec_AD_Cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-12</div><div class="info-item-2">深度学习小记</div></div><div class="info-2"><div class="info-item-1">深度学习小记Created by: Yuanpeng QUCreated time: 2025年8月12日 17:41 I. 神经网络的核心组件与训练技巧1. 归一化层：BN 与 LN 的原理、区别与应用场景 核心目的：解决“内部协变量偏移 (Internal Covariate Shift)”问题。即在训练中，由于前层网络参数不断变化，导致后层网络接收到的数据分布一直在变，拖慢收敛速度。归一化层通过将每层网络的输入强制拉回到一个稳定的分布（如均值为0，方差为1），从而加速训练。 Batch Normalization (BN) 原理：“纵向”或“按特征”归一化。它在一个批次（mini-batch）内，对每一个特征维度计算均值和方差，并进行归一化。 关键机制：引入了两个可学习的参数 γ (缩放) 和 β (平移)，让网络可以自主决定是否以及在多大程度上恢复原始的分布，以保证模型的表达能力。 训练 vs 推理：训练时使用当前批次的统计量，同时用滑动平均记录全局统计量；推理时则使用保存下来的全局统计量，以保证输出的确定性。 应用场景：在卷积神经网络 (CNN)...</div></div></div></a><a class="pagination-related" href="/2025/08/12/ML_1/" title="机器学习小记"><img class="cover" src="/images/cover/Rec_AD_Cover.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-12</div><div class="info-item-2">机器学习小记</div></div><div class="info-2"><div class="info-item-1">机器学习小记Created by: Yuanpeng QUCreated time: 2025年8月13日 10:43 第一部分：神经网络的核心组件 (Core Components of Neural Networks)1.1 激活函数：从经典到现代激活函数是神经网络的灵魂，它负责向网络中引入非线性，使得网络有能力学习和拟合现实世界中复杂的非线性关系。如果没有激活函数，多层神经网络本质上等同于一个单层的线性模型。 1.1.1 Sigmoid &amp; Tanh：经典饱和函数的特性与局限性 1. Sigmoid 函数  公式：   $$  f(x) &#x3D; \frac{1}{1+e^{-x}}  $$  核心特性：  将任意实数输入压缩到 (0, 1) 区间内。 这个特性使其输出可以被直观地解释为概率，因此在逻辑回归以及各类分类模型的输出层中，当需要预测一个概率时，Sigmoid 仍然是标准选择。特别是在CTR&#x2F;CVR预估中，它的地位不可动摇。   主要局限性 (面试重点):  梯度消失 (Vanishing Gradient): 这是 Sigmoid...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/LOGO.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Yuanpeng QU</div><div class="author-info-description">CS PhD, 3rd yr.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><a id="card-info-btn" href="https://qyp9909.github.io/homepage"><i class="fas fa-user-graduate"></i><span>Academic Homepage</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/qyp9909/qyp9909.github.io" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:qyp9909@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E5%B9%BF%E6%8E%A8-%E6%8C%87%E6%A0%87"><span class="toc-number">1.</span> <span class="toc-text">搜广推[指标]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E5%BC%80%E7%AF%87%EF%BC%9A%E4%BB%8E%E2%80%9C%E7%BA%BF%E4%B8%8A%E7%BA%BF%E4%B8%8B%E4%B8%8D%E4%B8%80%E8%87%B4%E2%80%9D%E8%B0%88%E8%B5%B7%E2%80%94%E2%80%94%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A6%81%E6%AD%A3%E7%A1%AE%E7%9A%84%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">一、 开篇：从“线上线下不一致”谈起——我们为何需要正确的评估指标？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E6%A0%B8%E5%BF%83%E5%88%86%E9%87%8E%EF%BC%9A%E7%90%86%E8%A7%A3%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E7%9A%84%E4%B8%A4%E5%A4%A7%E5%AE%B6%E6%97%8F%E2%80%94%E2%80%94%E5%88%86%E7%B1%BB%E6%8C%87%E6%A0%87-vs-%E6%8E%92%E5%BA%8F%E6%8C%87%E6%A0%87"><span class="toc-number">3.</span> <span class="toc-text">二、 核心分野：理解评估指标的两大家族——分类指标 vs. 排序指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1%E8%AF%84%E4%BC%B0%EF%BC%9A%E8%B5%B0%E5%87%BA%E2%80%9C%E5%87%86%E7%A1%AE%E7%8E%87%E9%99%B7%E9%98%B1%E2%80%9D%EF%BC%8C%E6%8B%A5%E6%8A%B1P-R%E6%9D%83%E8%A1%A1%EF%BC%88%E7%B2%BE%E7%A1%AE%E7%8E%87%E3%80%81%E5%8F%AC%E5%9B%9E%E7%8E%87%E3%80%81F1%E5%88%86%E6%95%B0%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">三、 分类任务评估：走出“准确率陷阱”，拥抱P-R权衡（精确率、召回率、F1分数）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%87%E7%89%A9%E7%9A%84%E5%9F%BA%E7%A1%80%EF%BC%9A%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5-Confusion-Matrix"><span class="toc-number">5.</span> <span class="toc-text">1. 万物的基础：混淆矩阵 (Confusion Matrix)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E2%80%9C%E5%87%86%E7%A1%AE%E7%8E%87%E9%99%B7%E9%98%B1%E2%80%9D%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%8899-%E7%9A%84%E5%87%86%E7%A1%AE%E7%8E%87%E5%8F%AF%E8%83%BD%E6%AF%AB%E6%97%A0%E4%BB%B7%E5%80%BC%EF%BC%9F"><span class="toc-number">6.</span> <span class="toc-text">2. “准确率陷阱”：为什么99%的准确率可能毫无价值？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%B2%BE%E7%A1%AE%E7%8E%87-Precision-vs-%E5%8F%AC%E5%9B%9E%E7%8E%87-Recall-%EF%BC%9A%E4%B8%80%E6%9E%9A%E7%A1%AC%E5%B8%81%E7%9A%84%E4%B8%A4%E9%9D%A2"><span class="toc-number">7.</span> <span class="toc-text">3. 精确率 (Precision) vs. 召回率 (Recall)：一枚硬币的两面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B2%BE%E7%A1%AE%E7%8E%87-Precision-%E6%9F%A5%E5%87%86%E7%8E%87"><span class="toc-number">8.</span> <span class="toc-text">精确率 (Precision) &#x2F; 查准率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AC%E5%9B%9E%E7%8E%87-Recall-%E6%9F%A5%E5%85%A8%E7%8E%87"><span class="toc-number">9.</span> <span class="toc-text">召回率 (Recall) &#x2F; 查全率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-F1%E5%88%86%E6%95%B0%EF%BC%9A%E5%9C%A8%E2%80%9C%E5%87%86%E2%80%9D%E4%B8%8E%E2%80%9C%E5%85%A8%E2%80%9D%E4%B9%8B%E9%97%B4%E5%AF%BB%E6%B1%82%E5%B9%B3%E8%A1%A1"><span class="toc-number">10.</span> <span class="toc-text">4. F1分数：在“准”与“全”之间寻求平衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E6%8E%92%E5%BA%8F%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F%E7%9A%84%E7%8E%8B%E8%80%85%E2%80%94%E2%80%94AUC%E7%9A%84%E6%B7%B1%E5%88%BB%E5%86%85%E6%B6%B5%E4%B8%8E%E4%B8%AA%E6%80%A7%E5%8C%96%E5%8D%87%E7%BA%A7%EF%BC%88GAUC%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">四、 排序质量评估（上）：全局排序的王者——AUC的深刻内涵与个性化升级（GAUC）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F%E7%9A%84%E7%8E%8B%E8%80%85-%E2%80%94%E2%80%94-AUC-Area-Under-the-Curve"><span class="toc-number">12.</span> <span class="toc-text">(一) 全局排序的王者 —— AUC (Area Under the Curve)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E4%B8%AA%E6%80%A7%E5%8C%96%E5%8D%87%E7%BA%A7-%E2%80%94%E2%80%94-GAUC-Grouped-AUC"><span class="toc-number">13.</span> <span class="toc-text">(二) 个性化升级 —— GAUC (Grouped AUC)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81-%E6%8E%92%E5%BA%8F%E8%B4%A8%E9%87%8F%E8%AF%84%E4%BC%B0%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E9%9D%A2%E5%90%91%E7%94%A8%E6%88%B7%E7%9A%84Top-K%E5%88%97%E8%A1%A8%E8%AF%84%E4%BC%B0%EF%BC%88NDCG%E3%80%81Recall-k%E3%80%81Hit-Rate%EF%BC%89"><span class="toc-number">14.</span> <span class="toc-text">五、 排序质量评估（下）：面向用户的Top-K列表评估（NDCG、Recall@k、Hit Rate）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%91%BD%E4%B8%AD%E7%8E%87-Hit-Rate-k-%E2%80%94%E2%80%94-%E2%80%9C%E6%88%91%E7%9A%84%E6%8E%A8%E8%8D%90%E6%9C%89%E7%94%A8%E5%90%97%EF%BC%9F%E2%80%9D"><span class="toc-number">15.</span> <span class="toc-text">1. 命中率 (Hit Rate @k) —— “我的推荐有用吗？”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8F%AC%E5%9B%9E%E7%8E%87-Recall-k-%E2%80%94%E2%80%94-%E2%80%9C%E7%94%A8%E6%88%B7%E5%96%9C%E6%AC%A2%E7%9A%84%EF%BC%8C%E6%88%91%E6%89%BE%E5%9B%9E%E4%BA%86%E5%A4%9A%E5%B0%91%EF%BC%9F%E2%80%9D"><span class="toc-number">16.</span> <span class="toc-text">2. 召回率 (Recall @k) —— “用户喜欢的，我找回了多少？”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NDCG-k-%E5%BD%92%E4%B8%80%E5%8C%96%E6%8A%98%E6%8D%9F%E7%B4%AF%E8%AE%A1%E5%A2%9E%E7%9B%8A-%E2%80%94%E2%80%94-%E2%80%9C%E6%8E%92%E5%BE%97%E5%A5%BD%E4%B8%8D%E5%A5%BD%EF%BC%9F%E2%80%9D"><span class="toc-number">17.</span> <span class="toc-text">3. NDCG @k (归一化折损累计增益) —— “排得好不好？”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81-%E8%BF%9B%E9%98%B6%E8%BE%A8%E6%9E%90%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8ROC-AUC%E4%B8%8EPR%E6%9B%B2%E7%BA%BF-F1%E5%88%86%E6%95%B0%E4%B9%8B%E9%97%B4%E5%81%9A%E5%87%BA%E6%AD%A3%E7%A1%AE%E9%80%89%E6%8B%A9%EF%BC%9F"><span class="toc-number">18.</span> <span class="toc-text">六、 进阶辨析：如何在ROC&#x2F;AUC与PR曲线&#x2F;F1分数之间做出正确选择？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%A8%E6%9E%90%E4%B8%80%EF%BC%9A%E6%A0%B7%E6%9C%AC%E4%B8%8D%E5%9D%87%E8%A1%A1%E9%97%AE%E9%A2%98-%E2%80%94%E2%80%94-ROC%E6%9B%B2%E7%BA%BF-vs-PR%E6%9B%B2%E7%BA%BF"><span class="toc-number">19.</span> <span class="toc-text">辨析一：样本不均衡问题 —— ROC曲线 vs. PR曲线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%A8%E6%9E%90%E4%BA%8C%EF%BC%9A%E4%B8%9A%E5%8A%A1%E7%9B%AE%E6%A0%87%E4%B8%8E%E5%BA%94%E7%94%A8-%E2%80%94%E2%80%94-AUC-vs-F1%E5%88%86%E6%95%B0"><span class="toc-number">20.</span> <span class="toc-text">辨析二：业务目标与应用 —— AUC vs. F1分数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%86%B3%E7%AD%96%E6%B5%81%E7%A8%8B"><span class="toc-number">21.</span> <span class="toc-text">总结与决策流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81-%E7%BB%88%E6%9E%81%E8%AF%9D%E9%A2%98%EF%BC%9A%E5%BD%93%E6%A8%A1%E5%9E%8B%E2%80%9C%E8%AF%B4%E8%B0%8E%E2%80%9D%E6%97%B6%E2%80%94%E2%80%94%E8%B6%85%E8%B6%8A%E6%8E%92%E5%BA%8F%EF%BC%8C%E8%AF%84%E4%BC%B0%E9%A2%84%E6%B5%8B%E7%9A%84%E2%80%9C%E5%8F%AF%E4%BF%A1%E5%BA%A6%E2%80%9D%EF%BC%88%E6%A0%A1%E5%87%86%E5%BA%A6%E4%B8%8ELogLoss%EF%BC%89"><span class="toc-number">22.</span> <span class="toc-text">七、 终极话题：当模型“说谎”时——超越排序，评估预测的“可信度”（校准度与LogLoss）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81-%E6%80%BB%E7%BB%93%EF%BC%9A%E4%BB%8E%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87%E5%88%B0%E4%B8%9A%E5%8A%A1%E4%BB%B7%E5%80%BC%E2%80%94%E2%80%94%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%9C%80%E5%90%88%E9%80%82%E7%9A%84%E6%8C%87%E6%A0%87%E9%A9%B1%E5%8A%A8%E5%A2%9E%E9%95%BF%EF%BC%9F"><span class="toc-number">23.</span> <span class="toc-text">八、 总结：从技术指标到业务价值——如何选择最合适的指标驱动增长？</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/14/leetcode/LeetCode%20Hot100-Day%201/" title="LeetCode Hot100-Day 1"><img src="/images/cover/leetcode.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LeetCode Hot100-Day 1"/></a><div class="content"><a class="title" href="/2025/08/14/leetcode/LeetCode%20Hot100-Day%201/" title="LeetCode Hot100-Day 1">LeetCode Hot100-Day 1</a><time datetime="2025-08-14T02:00:00.000Z" title="Created 2025-08-14 11:00:00">2025-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/13/leetcode/LeetCode%20Hot100-Day%200/" title="LeetCode Hot100-Day 0"><img src="/images/cover/leetcode.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LeetCode Hot100-Day 0"/></a><div class="content"><a class="title" href="/2025/08/13/leetcode/LeetCode%20Hot100-Day%200/" title="LeetCode Hot100-Day 0">LeetCode Hot100-Day 0</a><time datetime="2025-08-13T13:00:00.000Z" title="Created 2025-08-13 22:00:00">2025-08-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/12/ML_1/" title="机器学习小记"><img src="/images/cover/Rec_AD_Cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机器学习小记"/></a><div class="content"><a class="title" href="/2025/08/12/ML_1/" title="机器学习小记">机器学习小记</a><time datetime="2025-08-12T09:00:00.000Z" title="Created 2025-08-12 18:00:00">2025-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/12/DL_1/" title="深度学习小记"><img src="/images/cover/Rec_AD_Cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深度学习小记"/></a><div class="content"><a class="title" href="/2025/08/12/DL_1/" title="深度学习小记">深度学习小记</a><time datetime="2025-08-12T03:00:00.000Z" title="Created 2025-08-12 12:00:00">2025-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/11/Rec_AD_Metrics/" title="搜广推笔记 指标"><img src="/images/cover/Rec_AD_Cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="搜广推笔记 指标"/></a><div class="content"><a class="title" href="/2025/08/11/Rec_AD_Metrics/" title="搜广推笔记 指标">搜广推笔记 指标</a><time datetime="2025-08-11T06:00:00.000Z" title="Created 2025-08-11 15:00:00">2025-08-11</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By Yuanpeng QU</div><div class="footer_custom_text">Welcome to Kyoku's <a href="https://qyp9909.github.io/">blog</a>! All right reserved.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="255,255,255" opacity="0.8" zIndex="-1" count="200" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>